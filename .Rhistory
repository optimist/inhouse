library(inhouse)
library(inhouse)
library(inhouse)
devtools::install_github(repo = "optimist", user = "optimist")
devtools::install_github(repo = "inhouse", user = "optimist")
getwd()
install()
library(devtools)
install()
install.packages("Rcpp")
library(inhouse)
devtools::install_github(repo = "inhouse", user = "optimist")
devtools::install_github(repo = "optimist/inhouse")
install.packages("curl")
?dbConnect
?dbGetQuery
bloq <- DBI::dbConnecdtbGetQuery(con, query)
library(inhouse)
library(inhouse)
devtools::install_github(repo = "optimist/inhouse")
date
date <- "2016-11-16"
contrato <- "50017"
con <- DBI::dbConnect(RMySQL::MySQL(), host='CISM21', username="cism", password="cism", dbname="portafolio")
query <- paste("select ",
"fecha, carteramodelo, contrato, tot, reporto, tipo, emisora, serie, precio, tit, mon ",
"from posiciones where ",
"fecha in ('",
paste(date, collapse = "','"),
"') ",
sep="")
date <- c("2016-11-15", "2016-11-16")
query <- paste("select ",
"fecha, carteramodelo, contrato, tot, reporto, tipo, emisora, serie, precio, tit, mon ",
"from posiciones where ",
"fecha in ('",
paste(date, collapse = "','"),
"') ",
sep="")
query
if(!is.null(contrato)) {
query <- paste(query,
"and contrato in ('",
paste(contrato, collapse ="','"),
"') ",
sep="")
}
query
pos <- DBI::dbGetQuery(con, query)
pos
pos %>%
#as date
mutate(fecha = as.Date(fecha)) %>%
#repo
mutate(tipo = replace(tipo, reporto == "R", "")) %>%
mutate(emisora = replace(emisora, reporto == "R", "EFECTIVO")) %>%
mutate(serie = replace(serie, reporto == "R", "")) %>%
mutate(precio = replace(precio, reporto == "R", 1)) %>%
mutate(tit = replace(tit, reporto == "R", 0))
library(DPLYR)
library(dplyr)
pos %>%
#as date
mutate(fecha = as.Date(fecha)) %>%
#repo
mutate(tipo = replace(tipo, reporto == "R", "")) %>%
mutate(emisora = replace(emisora, reporto == "R", "EFECTIVO")) %>%
mutate(serie = replace(serie, reporto == "R", "")) %>%
mutate(precio = replace(precio, reporto == "R", 1)) %>%
mutate(tit = replace(tit, reporto == "R", 0))
pos %>%
#as date
mutate(fecha = as.Date(fecha)) %>%
#repo
mutate(tipo = replace(tipo, reporto == "R", "")) %>%
mutate(emisora = replace(emisora, reporto == "R", "EFECTIVO")) %>%
mutate(serie = replace(serie, reporto == "R", "")) %>%
mutate(precio = replace(precio, reporto == "R", 1)) %>%
mutate(tit = replace(tit, reporto == "R", 0)) %>%
#id
mutate(id = asset_id(tipo, emisora, serie))
asset_id <- function(tipo, emisora, serie) {
tipo[nchar(tipo) == 1] <- paste0(tipo[nchar(tipo) == 1], "_")
id <- tolower(paste0(tipo, emisora, serie))
id <- gsub("\\*|\\+|\\-", "_", id)
id
}
pos %>%
#as date
mutate(fecha = as.Date(fecha)) %>%
#repo
mutate(tipo = replace(tipo, reporto == "R", "")) %>%
mutate(emisora = replace(emisora, reporto == "R", "EFECTIVO")) %>%
mutate(serie = replace(serie, reporto == "R", "")) %>%
mutate(precio = replace(precio, reporto == "R", 1)) %>%
mutate(tit = replace(tit, reporto == "R", 0)) %>%
#id
mutate(id = asset_id(tipo, emisora, serie))
pos %>%
#as date
mutate(fecha = as.Date(fecha)) %>%
#repo
mutate(tipo = replace(tipo, reporto == "R", "")) %>%
mutate(emisora = replace(emisora, reporto == "R", "EFECTIVO")) %>%
mutate(serie = replace(serie, reporto == "R", "")) %>%
mutate(precio = replace(precio, reporto == "R", 1)) %>%
mutate(tit = replace(tit, reporto == "R", 0)) %>%
#id
mutate(id = asset_id(tipo, emisora, serie)) %>%
#group
group_by(fecha, carteramodelo, contrato, tot, id, reporto, tipo, emisora, serie, precio)
pos %>%
#as date
mutate(fecha = as.Date(fecha)) %>%
#repo
mutate(tipo = replace(tipo, reporto == "R", "")) %>%
mutate(emisora = replace(emisora, reporto == "R", "EFECTIVO")) %>%
mutate(serie = replace(serie, reporto == "R", "")) %>%
mutate(precio = replace(precio, reporto == "R", 1)) %>%
mutate(tit = replace(tit, reporto == "R", 0)) %>%
#id
mutate(id = asset_id(tipo, emisora, serie)) %>%
#group
group_by(fecha, carteramodelo, contrato, tot, id, reporto, tipo, emisora, serie, precio) %>%
summarise(tit = sum(tit), mon = sum(mon))
pos %>%
#as date
mutate(fecha = as.Date(fecha)) %>%
#repo
mutate(tipo = replace(tipo, reporto == "R", "")) %>%
mutate(emisora = replace(emisora, reporto == "R", "EFECTIVO")) %>%
mutate(serie = replace(serie, reporto == "R", "")) %>%
mutate(precio = replace(precio, reporto == "R", 1)) %>%
mutate(tit = replace(tit, reporto == "R", 0)) %>%
#id
mutate(id = asset_id(tipo, emisora, serie)) %>%
#group
group_by(fecha, carteramodelo, contrato, tot, id, reporto, tipo, emisora, serie, precio) %>%
summarise(tit = sum(tit), mon = sum(mon))
pos <- pos %>%
#as date
mutate(fecha = as.Date(fecha)) %>%
#repo
mutate(tipo = replace(tipo, reporto == "R", "")) %>%
mutate(emisora = replace(emisora, reporto == "R", "EFECTIVO")) %>%
mutate(serie = replace(serie, reporto == "R", "")) %>%
mutate(precio = replace(precio, reporto == "R", 1)) %>%
mutate(tit = replace(tit, reporto == "R", 0)) %>%
#id
mutate(id = asset_id(tipo, emisora, serie)) %>%
#group
group_by(fecha, carteramodelo, contrato, tot, id, reporto, tipo, emisora, serie, precio) %>%
summarise(tit = sum(tit), mon = sum(mon)) %>%
as.data.frame()
pos
pos$tit[pos$emisora=="EFECTIVO"] <- pos$mon[pos$emisora=="EFECTIVO"]
pos
pos[pos$tit > 0, ]
library(inhouse)
create_pos(date, contrato)
contrato
date
pos %>%
#as date
mutate(fecha = as.Date(fecha)) %>%
#repo
mutate(tipo = replace(tipo, reporto == "R", "")) %>%
mutate(emisora = replace(emisora, reporto == "R", "EFECTIVO")) %>%
mutate(serie = replace(serie, reporto == "R", "")) %>%
mutate(precio = replace(precio, reporto == "R", 1)) %>%
mutate(tit = replace(tit, reporto == "R", 0)) %>%
#id
mutate(id = asset_id(tipo, emisora, serie)) %>%
#group
group_by(fecha, carteramodelo, contrato, tot, id, reporto, tipo, emisora, serie, precio) %>%
summarise(tit = sum(tit), mon = sum(mon)) %>%
as.data.frame()
pos %>%
#as date
mutate(fecha = as.Date(fecha)) %>%
#repo
mutate(tipo = replace(tipo, reporto == "R", "")) %>%
mutate(emisora = replace(emisora, reporto == "R", "EFECTIVO")) %>%
mutate(serie = replace(serie, reporto == "R", "")) %>%
mutate(precio = replace(precio, reporto == "R", 1)) %>%
mutate(tit = replace(tit, reporto == "R", 0)) %>%
#id
mutate(id = asset_id(tipo, emisora, serie)) %>%
#group
group_by(fecha, carteramodelo, contrato, tot, id, reporto, tipo, emisora, serie, precio) %>%
summarise(tit = sum(tit), mon = sum(mon)) %>%
as.data.frame()
?%>%
library(inhouse)
create_pos(date, contrato)
install()
library(devtools)
install()
library(inhouse)
create_pos(date, contrato)
dplyr
library(inhouse)
library(inhouse)
library(inhouse)
library(inhouse)
library(inhouse)
